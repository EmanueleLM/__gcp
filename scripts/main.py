# -*- coding: utf-8 -*-
"""
Created on Sun Jun 30 14:47:47 2019

@author: Emanuele
"""

import parameters as param
import evolutionary_tree as evotree

if __name__ == '__main__':
    
    seed_noise = 123
    num_parameters = 1008450
    noise_size = 250000000
    noise_stdev = 2e-3
    name_flat_file = 'results/experiments_224iters_popsize10_var2e-3/flat.npy'
    name_adj_matrices = 'results/experiments_224iters_popsize10_var2e-3/adj_'
    net_parameters = [(8, 8, 4, 16), (1, 1, 1, 16), (4, 4, 16, 32), (1, 1, 1, 32), (3872, 256), (256,), (256, 18), (18,)]
    elite_seed = [93013133, 79078986, 20365635, 126967462, 229005668, 128260924, 79200646, 43375196, 152212964, 12828643, 105103888, 21638146, 23239259, 214785346, 204279947, 19372960, 104240640, 88690910, 149635257, 241327221, 207460567, 204487819, 196275548, 26261949, 76151264, 80892402, 141194131, 217931016, 123198588, 56586966, 244303460, 139398337, 56637058, 133058633, 84871579, 58217417, 10731223, 67775939, 101924694, 213336793, 213249107, 20565713, 44496282, 164542730, 54797583, 150943101, 164302467, 148933404, 203450153, 220453485, 113152510, 80945714, 72245000, 66908869, 235310800, 180354296, 76684848, 128422564, 147698308, 35966166, 185518189, 20592274, 118431289, 19032292, 67015614, 61301077, 83776987, 118507144, 68392948, 175536366, 148574166, 234437589, 24182183, 37463662, 39943859, 175137680, 64868956, 192069946, 5361432, 53508817, 117478001, 76077275, 124864996, 4593074, 29531824, 201517863, 117890682, 82638063, 246429291, 155645255, 248771202, 63628633, 237507496, 207355772, 86296939, 164631268, 208079384, 127016672, 180149076, 214845035, 31382115, 83199776, 109537851, 160610639, 64420831, 116691971, 239166778, 183229465, 56439616, 238281455, 235495928, 18648394, 246218783, 39497014, 23316634, 43125102, 57951382, 34398774, 245469318, 237657504, 201692999, 22612044, 3484619, 63180836, 54403624, 210232539, 188631087, 164777207, 167435859, 88490355, 144137825, 224667122, 229512047, 137468953, 159106585, 191931522, 49062933, 85882714, 120135640, 106964395, 150519300, 234838682, 169908244, 196749965, 10152769, 180703033, 246003402, 125592377, 120343332, 88010674, 92749198, 86470259, 117523316, 227399550, 173215605, 230047538, 211682599, 52431954, 143190544, 245567875, 41975010, 34707040, 216604862, 108445585, 130916651, 18449480, 186756328, 113823706, 106626213, 96118112, 197443328, 25364821, 70737932, 49519454, 83090925, 66320971, 108915532, 58852254]
    
    # reconstruct flat weights
    flat = param.get_flat_parameters(elite_seed,
                                     parameters=num_parameters,
                                     seed=seed_noise,
                                     count=noise_size,
                                     noise_stdev=noise_stdev, 
                                     save_to_file=True, 
                                     dst=name_flat_file)
    
    # from flat to adjacency, each flat vector is processed indipendently
    len_elite = len(elite_seed)
    for i in range(len_elite):
        
        print("Processing matrix nÂ°", i, " out of ", len_elite-1)
        dst_adj_matrices = name_adj_matrices + "gen_" +str(i) + '.npy'
        param.get_adjacency_matrices(net_parameters,
                                     flat[i],
                                     save_to_file=True, 
                                     dst=dst_adj_matrices)

    # read list of seeds and write the complete tree to file
    src_seeds = 'seeds/seeds_experiments_224iters_popsize10_var2e-3.txt'
    dst_tree = 'results/experiments_224iters_popsize10_var2e-3/tree'
    evotree.draw_tree(src_seeds, dst_tree, diff_gen=True, draw_labels=True)
    